@model TicketSystemWeb.ViewModels.ManagementViewModel

@{
    ViewData["Title"] = "Project Management";
}

<h2>Project Management</h2>
<table class="table table-bordered table-striped">
    <thead>
        <tr>
            <th>Title</th>
            <th>Description</th>
            <th>Manager</th>
            <th>Groups Assigned</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var project in Model.Projects)
        {
            <tr>
                <td>@project.Title</td>
                <td>@project.Description</td>
                <td>@(project.ProjectManager != null ? project.ProjectManager.UserName : "None")</td>
                <td>
                    @if (project.ProjectGroups != null && project.ProjectGroups.Any())
                    {
                        @foreach (var group in project.ProjectGroups.Select(pg => pg.Group))
                        {
                            <span class="badge bg-secondary">@group.Name</span>
                        }
                    }
                    else
                    {
                        <span class="text-muted">No Groups Assigned</span>
                    }
                </td>
                <td>
                    @if (User.IsInRole("admin") || project.ProjectManagerId == User.FindFirst(System.Security.Claims.ClaimTypes.NameIdentifier)?.Value)
                    {
                        <button class="btn btn-warning"
                                onclick="openEditProjectModal(@project.Id, '@project.Title', '@project.Description', [@(string.Join(",", project.ProjectGroups.Select(pg => pg.GroupId.ToString())))], '@project.ProjectManagerId')">
                            Edit
                        </button>
                        <button class="btn btn-danger" onclick="openRemoveProjectModal(@project.Id)">Remove</button>
                    }
                </td>
            </tr>
        }
    </tbody>
</table>

<div class="modal fade" id="addProjectModal" tabindex="-1" aria-labelledby="addProjectModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addProjectModalLabel">Add Project</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="addProjectForm">
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="addTitle" class="form-label">Title*</label>
                        <input type="text" class="form-control" id="addTitle" name="Title" required>
                        <div class="invalid-feedback">Title is required.</div>
                    </div>
                    <div class="mb-3">
                        <label for="addDescription" class="form-label">Description*</label>
                        <textarea class="form-control" id="addDescription" name="Description" required></textarea>
                        <div class="invalid-feedback">Description is required.</div>
                    </div>
                    <div class="mb-3">
                        <label for="addManager" class="form-label">Assign Manager*</label>
                        <select class="form-control" id="addManager" name="ProjectManagerId" required>
                            <option value="">-- Select Manager --</option>
                            @foreach (var employee in Model.AllEmployees)
                            {
                                <option value="@employee.Id">@employee.UserName</option>
                            }
                        </select>
                        <div class="invalid-feedback">Please select a manager.</div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Assign Groups*</label>
                        <div class="row">
                            <!-- Available Groups -->
                            <div class="col">
                                <label class="form-label">Available Groups</label>
                                <select id="availableGroups" class="form-control" multiple>
                                    @foreach (var group in Model.Groups)
                                    {
                                        <option value="@group.Id">@group.Name</option>
                                    }
                                </select>
                            </div>

                            <!-- Move Buttons -->
                            <div class="col-auto d-flex flex-column justify-content-center">
                                <button type="button" class="btn btn-sm btn-primary mb-2"
                                        onclick="moveSelected('availableGroups', 'selectedGroups')"
                                        style="background-color: #6f42c1; border-color: #6f42c1;">
                                    >>
                                </button>
                                <button type="button" class="btn btn-sm btn-primary"
                                        onclick="moveSelected('selectedGroups', 'availableGroups')"
                                        style="background-color: #6f42c1; border-color: #6f42c1;">
                                    <<
                                </button>
                            </div>

                            <!-- Selected Groups -->
                            <div class="col">
                                <label class="form-label">Selected Groups</label>
                                <select id="selectedGroups" class="form-control" multiple name="SelectedGroupIds">
                                    @foreach (var group in Model.Groups.Where(g => Model.SelectedGroupIds.Contains(g.Id)))
                                    {
                                        <option value="@group.Id">@group.Name</option>
                                    }
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="validateAndSubmitProjectForm()" style="background-color: #6f42c1; border-color: #6f42c1; color: white;">Add</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                </div>
            </form>
        </div>
    </div>
</div>
<div class="modal fade" id="editProjectModal" tabindex="-1" aria-labelledby="editProjectModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editProjectModalLabel">Edit Project</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form asp-controller="ProjectManagement" asp-action="UpdateProject" method="post">
                <input type="hidden" id="editProjectId" name="ProjectId" />
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="editTitle" class="form-label">Title*</label>
                        <input type="text" class="form-control" id="editTitle" name="Title" required>
                    </div>
                    <div class="mb-3">
                        <label for="editDescription" class="form-label">Description*</label>
                        <textarea class="form-control" id="editDescription" name="Description" required></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="editManager" class="form-label">Assign Manager*</label>
                        <select class="form-control" id="editManager" name="ProjectManagerId" required>
                            <option value="">-- Select Manager --</option>
                            @foreach (var employee in Model.AllEmployees)
                            {
                                <option value="@employee.Id">@employee.UserName</option>
                            }
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Assigned Groups*</label>
                        <div class="row">
                            <!-- Available Groups -->
                            <div class="col">
                                <label class="form-label">Available Groups</label>
                                <select id="editAvailableGroups" class="form-control" multiple>
                                    @foreach (var group in Model.Groups)
                                    {
                                        <option value="@group.Id">@group.Name</option>
                                    }
                                </select>
                            </div>

                            <!-- Move Buttons -->
                            <div class="col-auto d-flex flex-column justify-content-center">
                                <button type="button" class="btn btn-sm btn-primary mb-2"
                                        onclick="moveSelected('editAvailableGroups', 'editSelectedGroups')"
                                        style="background-color: #6f42c1; border-color: #6f42c1;">
                                    >>
                                </button>
                                <button type="button" class="btn btn-sm btn-primary"
                                        onclick="moveSelected('editSelectedGroups', 'editAvailableGroups')"
                                        style="background-color: #6f42c1; border-color: #6f42c1;">
                                    <<
                                </button>
                            </div>

                            <!-- Selected Groups -->
                            <div class="col">
                                <label class="form-label">Selected Groups</label>
                                <select id="editSelectedGroups" class="form-control" multiple name="SelectedGroupIds">
                                    @foreach (var group in Model.Groups.Where(g => Model.SelectedGroupIds.Contains(g.Id)))
                                    {
                                        <option value="@group.Id">@group.Name</option>
                                    }
                                </select>
                            </div>
                        </div>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-success" style="background-color: #6f42c1; border-color: #6f42c1; color: white;">Save Changes</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                </div>
            </form>
        </div>
    </div>
</div>
<div class="modal fade" id="removeProjectModal" tabindex="-1" aria-labelledby="removeProjectModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="removeProjectModalLabel">Confirm Project Removal</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form asp-controller="ProjectManagement" asp-action="DeleteProject" method="post">
                <input type="hidden" id="removeProjectId" name="projectId" value="" />
                <div class="modal-body">
                    <p>Are you sure you want to remove this project?</p>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-danger">Remove</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                </div>
            </form>
        </div>
    </div>
</div>

@if (Model.CanAddProject)
{
    <div class="d-flex justify-content-end mt-3">
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addProjectModal"
                style="background-color: #6f42c1; border-color: #6f42c1; color: white;">
            Add Project
        </button>
    </div>
}

<h2>Group Management</h2>
<table class="table table-bordered table-striped">
    <thead>
        <tr>
            <th>Name</th>
            <th>Manager</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var group in Model.Groups)
        {
            <tr>
                <td>@group.Name</td>
                <td>@(group.Manager != null ? group.Manager.UserName : "None")</td>
                <td>
                    @if (User.IsInRole("admin") || group.ManagerId == User.FindFirst(System.Security.Claims.ClaimTypes.NameIdentifier)?.Value)
                    {
                        <button class="btn btn-warning"
                                onclick="openEditGroupModal(@group.Id,
                            '@group.Name',
                            '@(group.ManagerId ?? "null")',
                            '@string.Join(",", group.EmployeeGroups.Select(eg => eg.EmployeeId))')">
                            Edit
                        </button>
                        <button class="btn btn-danger" onclick="openRemoveGroupModal(@group.Id)"> Remove </button>
                    }
                </td>
            </tr>
        }
    </tbody>
</table>

<div class="modal fade" id="addGroupModal" tabindex="-1" aria-labelledby="addGroupModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addGroupModalLabel">Add Group</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="addGroupForm">
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="groupName" class="form-label">Group Name*</label>
                        <input type="text" class="form-control" id="groupName" name="Name" required>
                        <div class="invalid-feedback">Group name is required.</div>
                    </div>
                    <div class="mb-3">
                        <label for="manager" class="form-label">Assign Manager*</label>
                        <select class="form-control" id="manager" name="SelectedManagerId" required>
                            <option value="">-- Select Manager --</option>
                            @foreach (var employee in Model.AllEmployees)
                            {
                                <option value="@employee.Id">@employee.UserName</option>
                            }
                        </select>
                        <div class="invalid-feedback">Please select a manager.</div>
                    </div>
                    <div class="mb-3">
                        <label for="employees" class="form-label">Add Employees*</label>
                        <select multiple class="form-control" id="employees" name="SelectedEmployeeIds" required>
                            @foreach (var employee in Model.AllEmployees)
                            {
                                <option value="@employee.Id">@employee.UserName</option>
                            }
                        </select>
                        <div class="invalid-feedback">At least one employee must be selected.</div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="validateAndSubmitGroupForm()" style="background-color: #6f42c1; border-color: #6f42c1; color: white;">Add</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                </div>
            </form>
        </div>
    </div>
</div>
<div class="modal fade" id="editGroupModal" tabindex="-1" aria-labelledby="editGroupModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editGroupModalLabel">Edit Group</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form asp-controller="ProjectManagement" asp-action="UpdateGroup" method="post">
                <input type="hidden" id="editGroupId" name="GroupId" />
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="editGroupName" class="form-label">Group Name*</label>
                        <input type="text" class="form-control" id="editGroupName" name="Name" required>
                    </div>
                    <div class="mb-3">
                        <label for="editManager" class="form-label">Assign Manager*</label>
                        <select class="form-control" id="editManager" name="SelectedManagerId" required>
                            <option value="">-- Select Manager --</option>
                            @foreach (var employee in Model.AllEmployees)
                            {
                                <option value="@employee.Id">@employee.UserName</option>
                            }
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="editEmployees" class="form-label">Add Employees*</label>
                        <select multiple class="form-control" id="editEmployees" name="SelectedEmployeeIds">
                            @foreach (var employee in Model.AllEmployees)
                            {
                                <option value="@employee.Id">@employee.UserName</option>
                            }
                        </select>
                        <small class="form-text text-muted">Hold Ctrl (Cmd on Mac) to select multiple employees.</small>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-success"
                            style="background-color: #6f42c1; border-color: #6f42c1; color: white;">
                        Save Changes
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                </div>
            </form>
        </div>
    </div>
</div>
<div class="modal fade" id="removeGroupModal" tabindex="-1" aria-labelledby="removeGroupModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="removeGroupModalLabel">Confirm Group Removal</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form asp-controller="ProjectManagement" asp-action="DeleteGroup" method="post">
                <input type="hidden" id="removeGroupId" name="groupId" />
                <div class="modal-body">
                    <p>Are you sure you want to remove this group?</p>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-danger">Remove</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                </div>
            </form>
        </div>
    </div>
</div>

@if (Model.CanManageGroups)
{
    <div class="d-flex justify-content-end mt-3">
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addGroupModal"
                style="background-color: #6f42c1; border-color: #6f42c1; color: white;">
            Add Group
        </button>
    </div>
}

<script>
    document.addEventListener("DOMContentLoaded", function () {
        var addGroupModal = document.getElementById("addGroupModal");
        if (addGroupModal) {
            addGroupModal.addEventListener("hidden.bs.modal", function () {
                resetForm("addGroupModal");
            });
        }

        var addProjectModal = document.getElementById("addProjectModal");
        if (addProjectModal) {
            addProjectModal.addEventListener("hidden.bs.modal", function () {
                resetForm("addProjectModal");
            });
        }
    });
    $(document).ready(function () {
        $(".edit-project-btn").click(function () {
            let projectId = $(this).data("project-id");
            let title = $(this).data("title");
            let description = $(this).data("description");
            let groupIds = $(this).data("group-ids").split(",").map(id => parseInt(id));
            $("#editProjectId").val(projectId);
            $("#editTitle").val(title);
            $("#editDescription").val(description);
            $("#editGroups option").each(function () {
                let optionValue = parseInt($(this).val());
                $(this).prop("selected", groupIds.includes(optionValue));
            });
            $("#editProjectModal").modal("show");
        });
    });
    $(document).ready(function () {
        $(".edit-group-btn").click(function () {
            let groupId = $(this).data("group-id");
            let groupName = $(this).data("group-name");

            $("#editGroupId").val(groupId);
            $("#editGroupName").val(groupName);

            $("#editGroupModal").modal("show");
        });
    });
    function validateAndSubmitProjectForm() {
        let form = document.getElementById("addProjectForm");
        if (form.checkValidity()) {
            addProject();
        } else {
            form.classList.add("was-validated");
        }
    }
    function validateAndSubmitGroupForm() {
        let form = document.getElementById("addGroupForm");
        if (form.checkValidity()) {
            addGroup();
        } else {
            form.classList.add("was-validated");
        }
    }
    async function addProject() {
    console.log("addProject function called!");

    let titleInput = document.getElementById("addTitle");
    let descriptionInput = document.getElementById("addDescription");
    let managerInput = document.getElementById("addManager");
    let groupSelect = document.getElementById("selectedGroups"); // Fixed reference

    if (!titleInput) console.error("Error: Element with ID 'addTitle' not found.");
    if (!descriptionInput) console.error("Error: Element with ID 'addDescription' not found.");
    if (!managerInput) console.error("Error: Element with ID 'addManager' not found.");
    if (!groupSelect) console.error("Error: Element with ID 'selectedGroups' not found.");

    if (!titleInput || !descriptionInput || !managerInput || !groupSelect) {
        console.error("One or more required form elements are missing.");
        return;
    }

    let title = titleInput.value.trim();
    let description = descriptionInput.value.trim();
    let managerId = managerInput.value;
    let groupIds = [...groupSelect.selectedOptions].map(opt => opt.value);

    let tokenInput = document.querySelector('input[name="__RequestVerificationToken"]');
    let token = tokenInput ? tokenInput.value : null;

    if (!token) {
        console.error("CSRF Token is missing.");
        return;
    }

    let formData = new URLSearchParams();
    formData.append("Title", title);
    formData.append("Description", description);
    formData.append("ProjectManagerId", managerId);
    formData.append("__RequestVerificationToken", token);
    groupIds.forEach(id => formData.append("GroupIds", id));

    console.log("Submitting form:", Object.fromEntries(formData));

    let response = await fetch("/ProjectManagement/CreateProject", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: formData
    });

    if (response.ok) {
        console.log("Project created successfully!");
        location.reload();
    } else {
        let errorMessage = await response.text();
        console.error("Error: " + errorMessage);
        alert(errorMessage);
    }
}
    async function updateProject() {
        let projectId = document.getElementById("editProjectId").value;
        let title = document.getElementById("editTitle").value.trim();
        let description = document.getElementById("editDescription").value.trim();
        let managerId = document.getElementById("editManager").value;
        let groupIds = [...document.getElementById("editGroups").selectedOptions].map(opt => opt.value);
        let token = document.querySelector('input[name="__RequestVerificationToken"]').value;
        let formData = new URLSearchParams();
        formData.append("ProjectId", projectId);
        formData.append("Title", title);
        formData.append("Description", description);
        formData.append("ProjectManagerId", managerId);
        formData.append("__RequestVerificationToken", token);
        groupIds.forEach(id => formData.append("SelectedGroupIds", id));
        let response = await fetch(`/ProjectManagement/UpdateProject`, {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: formData
        });
        if (response.ok) {
            location.reload();
        } else {
            let errorMessage = await response.text();
            alert(errorMessage);
        }
    }
    async function deleteProject(projectId) {
        let response = await fetch(`/ProjectManagement/DeleteProject?projectId=${projectId}`, {
            method: "POST"
        });
        if (response.ok) {
            location.reload();
        } else {
            let errorMessage = await response.text();
            alert(errorMessage);
        }
    }
    async function addGroup() {
        let groupName = document.getElementById("groupName").value.trim();
        let managerId = document.getElementById("manager").value;
        let employeeIds = [...document.getElementById("employees").selectedOptions].map(opt => opt.value);
        let token = document.querySelector('input[name="__RequestVerificationToken"]').value;
        let formData = new URLSearchParams();
        formData.append("Name", groupName);
        formData.append("SelectedManagerId", managerId);
        formData.append("__RequestVerificationToken", token);
        employeeIds.forEach(id => formData.append("SelectedEmployeeIds", id));
        let response = await fetch(`/ProjectManagement/CreateGroup`, {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: formData
        });
        if (response.ok) {
            location.reload();
        } else {
            let errorMessage = await response.text();
            alert(errorMessage);
        }
    }
    async function updateGroup() {
        let groupId = document.getElementById("editGroupId").value;
        let groupName = document.getElementById("editGroupName").value.trim();
        let managerId = document.getElementById("editManager").value;
        let employeeIds = [...document.getElementById("editEmployees").selectedOptions].map(opt => opt.value);
        let token = document.querySelector('input[name="__RequestVerificationToken"]').value;
        let formData = new URLSearchParams();
        formData.append("GroupId", groupId);
        formData.append("Name", groupName);
        formData.append("SelectedManagerId", managerId);
        formData.append("__RequestVerificationToken", token);
        employeeIds.forEach(id => formData.append("SelectedEmployeeIds", id));
        let response = await fetch(`/ProjectManagement/UpdateGroup`, {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: formData
        });
        if (response.ok) {
            location.reload();
        } else {
            let errorMessage = await response.text();
            alert(errorMessage);
        }
    }
    async function deleteGroup(groupId) {
        let response = await fetch(`/ProjectManagement/DeleteGroup?groupId=${groupId}`, {
            method: "POST"
        });
        if (response.ok) {
            location.reload();
        } else {
            let errorMessage = await response.text();
            alert(errorMessage);
        }
    }
    function openRemoveGroupModal(groupId) {
        document.getElementById("removeGroupId").value = groupId;
        var removeModal = new bootstrap.Modal(document.getElementById("removeGroupModal"));
        removeModal.show();
    }
    function resetForm(modalId) {
        var modal = document.getElementById(modalId);
        if (modal) {
            var form = modal.querySelector("form");
            if (form) {
                form.reset();
            }
        } 
    }
    function openRemoveProjectModal(projectId) {
        document.getElementById("removeProjectId").value = projectId;
        var removeModal = new bootstrap.Modal(document.getElementById("removeProjectModal"));
        removeModal.show();
    }
    function moveSelected(fromId, toId) {
        var from = document.getElementById(fromId);
        var to = document.getElementById(toId);
        var selectedOptions = [...from.selectedOptions];

        selectedOptions.forEach(option => {
            to.appendChild(option);
        });
    }
    function openEditProjectModal(projectId, title, description, groupIds, projectManagerId) {
        document.getElementById("editProjectId").value = projectId;
        document.getElementById("editTitle").value = title;
        document.getElementById("editDescription").value = description;

        let selectedGroupIds = groupIds.map(id => id.toString()); // Ensure string comparison

        // Set the project manager dropdown selection
        let managerSelect = document.getElementById("editManager");
        if (managerSelect) {
            for (let i = 0; i < managerSelect.options.length; i++) {
                if (managerSelect.options[i].value == projectManagerId) {
                    managerSelect.options[i].selected = true;
                    break;
                }
            }
        }

        // Get references to select lists
        let availableGroups = document.getElementById("editAvailableGroups");
        let selectedGroups = document.getElementById("editSelectedGroups");

        // Fetch all groups from the server
        fetch('/ProjectManagement/GetGroups')
            .then(response => response.json())
            .then(groups => {
                console.log("Fetched groups:", groups);

                groups.forEach(group => {
                    let option = new Option(group.Name, group.Id);
                    if (selectedGroupIds.includes(group.Id.toString())) {
                        selectedGroups.appendChild(option); // Add to selected groups
                    } else {
                        availableGroups.appendChild(option); // Add to available groups
                    }
                });

                console.log("Updated Available Groups:", availableGroups);
                console.log("Updated Selected Groups:", selectedGroups);
            })
            .catch(error => console.error("Error loading groups:", error));

        var editModal = new bootstrap.Modal(document.getElementById("editProjectModal"));
        editModal.show();
    }


    function openEditGroupModal(groupId, groupName, managerId, employeeIds) {
        document.getElementById("editGroupId").value = groupId;
        document.getElementById("editGroupName").value = groupName;
        var managerSelect = document.getElementById("editManager");
        if (managerSelect) {
            for (var i = 0; i < managerSelect.options.length; i++) {
                if (managerSelect.options[i].value == managerId) {
                    managerSelect.options[i].selected = true;
                    break;
                }
            }
        }
        var employeeSelect = document.getElementById("editEmployees");
        if (employeeSelect) {
            let selectedEmployeeIds = employeeIds.split(",").map(id => parseInt(id.trim()));
            for (var i = 0; i < employeeSelect.options.length; i++) {
                let optionValue = parseInt(employeeSelect.options[i].value);
                employeeSelect.options[i].selected = selectedEmployeeIds.includes(optionValue);
            }
        }
        var editModal = new bootstrap.Modal(document.getElementById("editGroupModal"));
        editModal.show();
    }
</script>
